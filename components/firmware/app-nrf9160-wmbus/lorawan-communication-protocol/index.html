<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">LoRaWAN Communication | Lobaro Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lobaro.github.io/iot/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lobaro.github.io/iot/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lobaro.github.io/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LoRaWAN Communication | Lobaro Documentation"><meta data-rh="true" name="description" content="The Gateway can use LoRaWAN as Uplink technology for forwarding received wireless M-BUS telegrams to any network server."><meta data-rh="true" property="og:description" content="The Gateway can use LoRaWAN as Uplink technology for forwarding received wireless M-BUS telegrams to any network server."><link data-rh="true" rel="icon" href="/iot/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lobaro.github.io/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol"><link data-rh="true" rel="alternate" href="https://lobaro.github.io/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol" hreflang="en"><link data-rh="true" rel="alternate" href="https://lobaro.github.io/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol" hreflang="x-default"><link rel="stylesheet" href="/iot/assets/css/styles.93d2bcca.css">
<script src="/iot/assets/js/runtime~main.7b385af5.js" defer="defer"></script>
<script src="/iot/assets/js/main.81ee6efb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/iot/"><div class="navbar__logo"><img src="/iot/img/logo.svg" alt="Lobaro GmbH - Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" width="115px"><img src="/iot/img/logoDark.svg" alt="Lobaro GmbH - Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" width="115px"></div><b class="navbar__title text--truncate">docs</b></a><a class="navbar__item navbar__link" href="/iot/products/">Products</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/iot/components/">Components</a><a class="navbar__item navbar__link" href="/iot/configuration/">Configuration</a><a class="navbar__item navbar__link" href="/iot/platform">IoT Platform</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><button onclick="history.back()">⬅️</button></div><div class="navbar__item"><button onclick="history.forward()">➡️</button></div><a class="navbar__item navbar__link" href="/iot/knowledge-base/">Knowledge Base</a><a href="https://www.lobaro.de" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Lobaro Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/iot/">Lobaro Docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/iot/products/">Products</a><button aria-label="Expand sidebar category &#x27;Products&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/iot/components/">Components</a><button aria-label="Collapse sidebar category &#x27;Components&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/iot/components/firmware/">Firmware</a><button aria-label="Collapse sidebar category &#x27;Firmware&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/introduction">app-nrf9160-wmbus</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/configuration-parameter">Configuration Parameter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol">LoRaWAN Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/cellular-iot-communication-protocol">Cellular IoT Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/firmware/app-nrf9160-wmbus/changelog-download">Changelog &amp; Updates</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/firmware/app-hybrid-modbus/">app-hybrid-modbus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/iot/components/enclosures/">Device Enclosures</a><button aria-label="Expand sidebar category &#x27;Device Enclosures&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/iot/components/addon-modules/">Hardware Addon Modules</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/iot/configuration/">Configuration</a><button aria-label="Expand sidebar category &#x27;Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/iot/platform/">IoT Platform</a><button aria-label="Expand sidebar category &#x27;IoT Platform&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/iot/knowledge-base/">Knowledge Base</a><button aria-label="Expand sidebar category &#x27;Knowledge Base&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/iot/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Lobaro Docs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/iot/components/"><span itemprop="name">Components</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/iot/components/firmware/"><span itemprop="name">Firmware</span></a><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">app-nrf9160-wmbus</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LoRaWAN Communication</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LoRaWAN Communication</h1>
<p>The Gateway can use LoRaWAN as Uplink technology for forwarding received wireless M-BUS telegrams to any network server.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>common misunderstanding</div><div class="admonitionContent_BuS1"><p>Products based on this firmware are <strong>not</strong> LoRaWAN Gateways. Thus, other LoRaWAN Devices / Sensors can not be received.
In fact the firmware acts itself as LoRaWAN node and <strong>needs</strong> an external LoRaWAN network which consists of one are
more LoRaWAN Gateways.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uplink-payload-formats">Uplink Payload Formats<a class="hash-link" aria-label="Direct link to Uplink Payload Formats" title="Direct link to Uplink Payload Formats" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#uplink-payload-formats">​</a></h2>
<p>After collecting wireless M-Bus telegrams over the air, the Bridge starts uploading data via LoRaWAN. There exist two
data formats that are transmitted over different LoRaWAN ports. As LoRaWAN can only transmit very short messages, the
message formats contain only data bytes. The meaning of a byte is determined by its position within a message. The
following describes the package formats used by the wireless M-Bus Bridge.</p>
<p>M-Bus telegrams can be longer as the maximal size of a LoRaWAN-Message. For this cases, the firmware needs to split a
telegram into multiple pieces and upload it using multiple LoRaWAN-Messages. There are two different methods this is
done, according to the payload pormat you set in the <a href="/iot/components/firmware/app-nrf9160-wmbus/configuration-parameter#lorawanparams">firmware configuration</a>.</p>
<p>A configuration with <code>PayloadFormat = 0</code> is focused on easy reassembly of the pieces. The parts are encoded by port
numbers and the data can
just be concatenated together. Payload Formats 1 and 2 add additional information to the telegram. They focus on putting
as much of a telegram in a single LoRaWAN-Message as possible with respecting the current Spreading Factor.</p>
<table><thead><tr><th style="text-align:center">LoRaWAN Port</th><th><code>PayloadFormat</code> Configuration</th><th>Uplink Message</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td><code>any</code></td><td>Status Message</td></tr><tr><td style="text-align:center">11-99</td><td><code>0</code></td><td>Default PayloadFormat. Part of split telegrams is encoded in Port (e.g. Port 24 = Telegram 2 of 4).</td></tr><tr><td style="text-align:center">101</td><td><code>1</code></td><td>Data Message with timestamp and without RSSI. Part of split telegrams is encoded in payload.</td></tr><tr><td style="text-align:center">102</td><td><code>2</code></td><td>Data Message with timestamp and with RSSI. Part of split telegrams is encoded in payload.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="status-packet-port-1">Status Packet (Port 1)<a class="hash-link" aria-label="Direct link to Status Packet (Port 1)" title="Direct link to Status Packet (Port 1)" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#status-packet-port-1">​</a></h3>
<p>In order to provide some information about the health &amp; connectivity state of the device itself, the device
sends a status update at a daily basis. The status packet is sent on the first upload phase after activation of the
device (after reboot) and then repeatedly in every upload phase that takes place a day or longer after the previous
status packet. It has a length of 7 or 8 bytes. The battery voltages and ambient temperature are encodes as 16 bit
integer using <strong>little endian encoding</strong>.</p>
<table><thead><tr><th>Field</th><th>Type</th><th>Bytes</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td>version</td><td>uint8[3]</td><td>0-2</td><td>Firmware Version</td><td>1, 5, 1 ≡ v1.5.1</td></tr><tr><td>v_bat</td><td>uint16</td><td>3-4</td><td>Battery Voltage [mV]</td><td>2947 ≡ 2.947V</td></tr><tr><td>temp</td><td>int16</td><td>5-6</td><td>Temperature [1/10 °C]</td><td>246  ≡ 24.6°C</td></tr><tr><td>flag</td><td>int8</td><td>7</td><td>Internal Flag</td><td>0x01</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-packet-payloadformat-0">Data Packet (PayloadFormat 0)<a class="hash-link" aria-label="Direct link to Data Packet (PayloadFormat 0)" title="Direct link to Data Packet (PayloadFormat 0)" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-0">​</a></h3>
<p>After each wMBUS collecting phase, all saved telegrams will be uploaded via LoRaWAN uplink
messages as fast as possible. The received wMBUS telegrams that did pass the configured filters will be
uploaded without any modification in one or more LoRaWAN messages.</p>
<p>If a wMBUS telegram is bigger than the bridge
configuration parameter loraMaxMsgSize the transmission will be done using multiple LoRaWAN messages. This parameter is
limited to ≤ 50 bytes due to LoRaWANs maximum payload size restrictions. In case of telegram splitting is needed the
receiving backend application server as to reassemble the original wMBUS telegram before decryption &amp; parsing of the
meter data. This is done by simply joining the messages together in the order of receive. The LoRaWAN port encodes
identifies a LoRaWAN fragment of the original wireless M-Bus telegram. This way partial messages can be identified using
the LoRaWAN Port:</p>
<ul>
<li>10 &lt; LoRaWAN Port &lt; 100 ≡ (Part Number | Total Parts)</li>
</ul>
<p>Gaps in the LoRaWAN Frame Counter are giving a hint for missing telegram parts which can happen in LoRaWAN since it&#x27;s a
ALOHA based protocol, e.g. collisions and some packet losses are accepted by principle of operation. In case the backend
noticed a missing packet the wMBUS telegram can&#x27;t be assembled anymore as described before.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#examples">​</a></h4>
<p>With a configuration of <code>loraMaxMsgSize</code> = 50:</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="length-48-byte-wmbus-telegram">Length 48 Byte wMBUS telegram<a class="hash-link" aria-label="Direct link to Length 48 Byte wMBUS telegram" title="Direct link to Length 48 Byte wMBUS telegram" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#length-48-byte-wmbus-telegram">​</a></h5>
<p>Will be send on LoRaWAN port 11. Port 11 says it is the first message of only one message (no splitting).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="length-75-byte-wmbus-telegram">Length 75 byte wMBUS telegram<a class="hash-link" aria-label="Direct link to Length 75 byte wMBUS telegram" title="Direct link to Length 75 byte wMBUS telegram" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#length-75-byte-wmbus-telegram">​</a></h5>
<p>Will be send in two messages on LoRaWAN ports 12 and 22. Port 12 means this part one of a wMBUS telegram that got
splitted into two LoRaWAN messages. Port 22 means that this data is the 2nd part of the original wMBUS data. Both parts
have to been concatenated in the order of receive by the backend.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="length-101-byte-wmbus-telegram">Length 101 byte wMBUS telegram<a class="hash-link" aria-label="Direct link to Length 101 byte wMBUS telegram" title="Direct link to Length 101 byte wMBUS telegram" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#length-101-byte-wmbus-telegram">​</a></h5>
<p>Will be send in three messages on LoRaWAN ports 13, 23 and 33. Port 13 means this part one of a wMBUS telegram that got
splitted into three LoRaWAN messages. Port 23 means that this data is the 2nd part of the original wMBUS data. Port 33
means that this data is the 3rd part of the original wMBUS data. All three parts have to been concatenated in the order
of receive by the backend.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-packet-payloadformat-1">Data Packet (PayloadFormat 1)<a class="hash-link" aria-label="Direct link to Data Packet (PayloadFormat 1)" title="Direct link to Data Packet (PayloadFormat 1)" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-1">​</a></h3>
<p>When using Payload Format 1, collected telegrams are uploaded on single port 101 <strong>without RSSI</strong> (of received wmbus
telegram) information. For each telegram there will be
added the timestamp of reception. The first byte of messages on Port 101 encodes splitting of messages as follows.</p>
<p>Every Uplink on Port 101 is prefixed with a single byte, where the least significant Bit indicates if that Uplink is the
first part of a message, and the second least significant Bit indicates if that Uplink is the last part or a message. So
there are 4 different possible values for the <strong>first Byte</strong> of an Uplink on Port 101:</p>
<ul>
<li>0x03:<!-- -->
<ul>
<li>This Uplink is both first and final part of a message. So the remaining Bytes in this Uplink contain the whole
message.</li>
</ul>
</li>
<li>0x02:<!-- -->
<ul>
<li>This Uplink is the last but not the first part of a message. There has been at least one Uplink before this one,
that contained data that needs to be prepended to the current Uplink in order to get the full Message</li>
</ul>
</li>
<li>0x01:<!-- -->
<ul>
<li>This Uplink is the first but not the last part of a message. There follows at least one Uplink that contains more
data to be appended to the current&#x27;s data in order to get the full message.</li>
</ul>
</li>
<li>0x00:<!-- -->
<ul>
<li>This Uplink is neither first nor last part of a message. There has been at least one Uplink before this one that
contains more data of the current Message, and there follows at least one more Uplink with data for this Message.</li>
</ul>
</li>
</ul>
<p>So each message sent on Port 101, whether it is contained in a single Uplink or spread over multiple ones, starts with
an Uplink where the least significant Bit of the first Byte is set. Each Message ends with an Uplink where the second
least significant Bit of the first Byte is set. In cases where the Message fits in a single Uplink, that Uplink is both
first and last Uplink, and therefore both Bits are set.</p>
<p>The combination of those two Bits and the Frame Counter of the Uplinks makes it possible to upload Messages of any
length while allowing the receiving side to know exactly if a Message has been transferred completely, or if part of it
is missing (when there are Frame Counter values missing).</p>
<p>The Bridge puts as many Bytes in each Uplink as possible for the current Spreading Factor, even if the Spreading Factor
changes between Uplinks because of ADR.</p>
<p>When the data of all Uplinks that are part of a single Message are appended in order of reception (after removing the
first Byte of each Uplink), you get the payload Data of a full message.</p>
<p>The Payload Data after reassembly of the split parts consists of a 5 Byte Timestamp, that marks the point in time the
Bridge did receive that telegram, followed by the Data of the Telegram. The Timestamp follows the convention of all our
40bit-Timestamps; you can find the details under Timestamp in our LoRaWAN Background Information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-packet-payloadformat-2">Data Packet (PayloadFormat 2)<a class="hash-link" aria-label="Direct link to Data Packet (PayloadFormat 2)" title="Direct link to Data Packet (PayloadFormat 2)" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-2">​</a></h3>
<p>Upload Format 2 works like Upload Format 1, with the same logic for splitting messages, but uploads are sent on port</p>
<ol start="102">
<li>The Payload consists of a 5 Byte Timestamp marking the time of reception, followed by a uint_8 that holds the (
negated) RSSI value for that reception, followed by the data of the Telegram.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples-1">Examples<a class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#examples-1">​</a></h3>
<p>For easier understanding, the wMBus-Telegram in the examples will always be <code>0102030405060708090a0b0c0d0e0f</code> (15 Byte).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="payloadformat-1">PayloadFormat 1<a class="hash-link" aria-label="Direct link to PayloadFormat 1" title="Direct link to PayloadFormat 1" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#payloadformat-1">​</a></h4>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">A message sent in a single Uplink</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An Uplink of 21 Bytes on Port 101:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">03005e53f31a0102030405060708090a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Analised:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">03</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">and</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Last</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> -&gt; </span><span class="token property" style="color:#36acaa">complete</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">in</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">this</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">005e53f31a</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Unix</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Timestamp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1582560026</span><span class="token plain"> -&gt; </span><span class="token number" style="color:#36acaa">2020</span><span class="token number" style="color:#36acaa">-02</span><span class="token plain">-</span><span class="token property" style="color:#36acaa">24T16</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">00</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UTC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">0102030405060708090a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">wMBus</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Telegram</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">A message split over two Uplinks</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An Uplink of 11 Bytes on Port 101, Frame Counter 341:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">01005e53f31a0102030405</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">01</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">more</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplinks</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102030405</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Another Uplink of 11 Bytes on Port 101, Frame Counter 342:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">02060708090a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">02</span><span class="token plain">&#x27; -&gt; </span><span class="token property-query">Last</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token property" style="color:#36acaa">but</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">not</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">first</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">060708090a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Second</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">and</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">final</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># We Received a &#x27;first&#x27; Part with Frame Counter 341 and a &#x27;last&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Part with Frame Counter 342, so we know we did not miss any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Parts in between. We can now assembly the complete payload:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102030405060708090a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Payload anaylsed:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">005e53f31a</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Unix</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Timestamp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1582560026</span><span class="token plain"> -&gt; </span><span class="token number" style="color:#36acaa">2020</span><span class="token number" style="color:#36acaa">-02</span><span class="token plain">-</span><span class="token property" style="color:#36acaa">24T16</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">00</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">26</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UTC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">0102030405060708090a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">wMBus</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Telegram</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">A message split over three Uplinks</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An Uplink of 8 Bytes on Port 101, Frame Counter 519:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">01005e53f31a0102</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">01</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">more</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplinks</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Another Uplink of 8 Bytes on Port 101, Frame Counter 520:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">0003040506070809</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">00</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Middle</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">there</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">have</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">been</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">some</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Parts</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">already</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">more</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplinks</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">03040506070809</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Second</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Another Uplink of 7 Bytes on Port 101, Frame Counter 521:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">020a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">02</span><span class="token plain">&#x27; -&gt; </span><span class="token property-query">Last</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token property" style="color:#36acaa">but</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">not</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">first</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">0a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Third</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">and</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">final</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Frame Counters are consecuetive, so the complete Message is:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102030405060708090a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Uplinks with a missing a Part</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An Uplink of 8 Bytes on Port 101, Frame Counter 123:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">01005e53f31a0102</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">01</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">more</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplinks</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Another Uplink of 7 Bytes on Port 101, Frame Counter 125:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">020a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">02</span><span class="token plain">&#x27; -&gt; </span><span class="token property-query">Last</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token property" style="color:#36acaa">but</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">not</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">first</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">0a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Third</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">and</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">final</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Frame Counter indicates, that a Part in the middle is missing,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># so we have to drop the Message.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="payloadformat-2">PayloadFormat 2<a class="hash-link" aria-label="Direct link to PayloadFormat 2" title="Direct link to PayloadFormat 2" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#payloadformat-2">​</a></h4>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">A message sent in a single Uplink</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An Uplink of 8 Bytes on Port 101, Frame Counter 123:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">01005e53f31a0102</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">01</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">more</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplinks</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">05e53f31a0102</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">First</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Another Uplink of 7 Bytes on Port 101, Frame Counter 125:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">020a0b0c0d0e0f</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token number" style="color:#36acaa">02</span><span class="token plain">&#x27; -&gt; </span><span class="token property-query">Last</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token property" style="color:#36acaa">but</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">not</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">first</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Uplink</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;</span><span class="token property" style="color:#36acaa">0a0b0c0d0e0f</span><span class="token plain">&#x27; -&gt; </span><span class="token property" style="color:#36acaa">Third</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">and</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">final</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Part</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">of</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Message</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">Data</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Frame Counter indicates, that a Part in the middle is missing,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># so we have to drop the Message.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="upload-speed--duration">Upload Speed / Duration<a class="hash-link" aria-label="Direct link to Upload Speed / Duration" title="Direct link to Upload Speed / Duration" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#upload-speed--duration">​</a></h2>
<p>The firmware has to work in compliance with the European SRD 868 1% duty-cycle regulations. This implies as a rule of
thumb the device can upload at most wireless M-BUS telegrams via LoRaWAN for 36 seconds every hour.</p>
<p>The actual transmit time (&#x27;ToA: time on air&#x27;) for each LoRaWAN message depends on the byte size and the used LoRa
spreading factor (SF) which defines how redundant LoRa data is send. This means a device with good connectivity and
consequently using LoRa SF7 (ToA ≤ 0,050s) can upload much faster more data than a node using LoRa SF11 (ToA ≥ 1s) due
to a hard to reach LoRaWAN gateway. The bridge will upload in conformity with the regulations automatically as fast as
possible. When it has to wait it enters a low power sleep mode until the next transmission is possible again. The next
data collection phase will be started only after completion of the previous upload phase in respect to the configured
listenCron parameter. Because of this it is advisable to define the cron parameter with an estimation of the upload
duration in mind. This will avoid unexpected &#x27;skipping&#x27; of data collection phases.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="downlink-payload-formats">Downlink Payload Formats<a class="hash-link" aria-label="Direct link to Downlink Payload Formats" title="Direct link to Downlink Payload Formats" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#downlink-payload-formats">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lorawan-downlink-ports">LoRaWAN Downlink Ports<a class="hash-link" aria-label="Direct link to LoRaWAN Downlink Ports" title="Direct link to LoRaWAN Downlink Ports" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#lorawan-downlink-ports">​</a></h3>
<table><thead><tr><th>Port</th><th>Message</th></tr></thead><tbody><tr><td>128</td><td>Remote Confiuration</td></tr><tr><td>132</td><td>Firmware Control Commands</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remote-configuration">Remote Configuration<a class="hash-link" aria-label="Direct link to Remote Configuration" title="Direct link to Remote Configuration" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#remote-configuration">​</a></h3>
<p>The remote configuration follows the general <a href="/iot/configuration/lorawan-downlink-config">Lobaro protocol</a> for over the
air configuration using LoRaWAN.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>in depth description</div><div class="admonitionContent_BuS1"><p><a href="/iot/configuration/lorawan-downlink-config">Read more</a> about LoRaWAN based downlink configuration.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="firmware-control-commands">Firmware Control Commands<a class="hash-link" aria-label="Direct link to Firmware Control Commands" title="Direct link to Firmware Control Commands" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#firmware-control-commands">​</a></h3>
<table><thead><tr><th>Port</th><th>Action</th><th>DL Payload (ASCII)</th><th>DL Payload (Hex)</th><th>DL Payload (Base64)</th></tr></thead><tbody><tr><td>132</td><td>Ad-hoc-readout</td><td><code>read</code></td><td><code>72656164</code></td><td><code>cmVhZA</code>==</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ad-hoc-readout">Ad-hoc-readout<a class="hash-link" aria-label="Direct link to Ad-hoc-readout" title="Direct link to Ad-hoc-readout" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#ad-hoc-readout">​</a></h4>
<p>A downlink that triggers an Ad hoc readout, independent of CRON triggers. The Ad-hoc readout is using the same
parameters (filters and listening duration) as a CRON triggered readout.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decodewmbus">Decoding wMBUS telegrams<a class="hash-link" aria-label="Direct link to Decoding wMBUS telegrams" title="Direct link to Decoding wMBUS telegrams" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#decodewmbus">​</a></h2>
<p>After receiving and reassemble the raw wireless M-Bus telegrams from your LoRaWAN network provider the actual metering data has to be
decrypted and decoded by a backend service for further processing. The details of this are described in the EN 13757
norm and the newer OMS specification, which is a clarification of the original underlying norm.</p>
<p>A universal wireless M-Bus decoder is a relatively complicated piece of software if you start implementing it from
scratch since the norm covers many different use cases, units, meter types and data formats. If you know in advance the
exact telegram format of the deployed meters in your setup a hard coded data decoding may be a feasible approach. This
is because wireless M-Bus devices often send the same telegram format in every transmission. Please contact the
manufacturer of your meters for the needed telegram format details.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Lobaro wireless M-BUS parser</div><div class="admonitionContent_BuS1"><p>An an alternative to support a quick evaluation of our hardware Lobaro offers a easy to use
webservice (<a href="https://www.mbus.org" target="_blank" rel="noopener noreferrer">mbus.org</a>) which is designed
to decode all sorts of wMBUS input data including decryption if the correct key has been provided. You can access the
decoder service for free during testing. The API can be licensed for production usages.</p><p>Since wireless MBUS is a complex and grown specification some meters may fail to decode correctly. We try to fix any
decoding issues as quickly as possible if you report us problems with your specific wMBUS device.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-js-parser">Example JS parser<a class="hash-link" aria-label="Direct link to Example JS parser" title="Direct link to Example JS parser" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#example-js-parser">​</a></h2>
<p>This parser may be used to decode the status message of this firmware send over LoRaWAN. For decoding wireless M-BUS telegram data see
the above <a href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#decodewmbus">documentation</a> about this topic.</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Status message LoRaWAN parser (Java-Script)</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readVersion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_sint16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> idx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">idx </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// temp is negative (16bit 2&#x27;s complement)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">~</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xffff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// invert 16bits &amp; add 1 =&gt; now positive value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Decode an uplink message from a buffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// (array) of bytes to an object of fields.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">devStatus</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">devID</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dif</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vif</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// example decoder for status packet by lobaro</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// status packet - old</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">FirmwareVersion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromCharCode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// byte 0-4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Vbat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// byte 6-7 (originally in mV)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_sint16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// byte 8-9 (originally in 10th degree C)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Firmware Version: v&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">FirmwareVersion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; Battery: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Vbat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;V Temperature: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;°C&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">FirmwareVersion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">readVersion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// byte 0-2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Vbat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// originally in mV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_sint16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// byte 8-9 (originally in 10th degree C)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">msg</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Firmware Version: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">FirmwareVersion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; Battery: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Vbat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;V Temperature: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Temp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;°C&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// added in v2.5.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            decoded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Flags</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Wrapper for Lobaro Platform</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Decode an incoming message to an object of fields.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">atob</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fPort</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> decoded</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Wrapper for Loraserver / ChirpStack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fPort</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Decoder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fPort</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Wrapper for Digimondo niota.io</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Uncomment only when used in niota!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">module.exports = function (payload, meta) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    const port = meta.lora.fport;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    const buf = Buffer.from(payload, &#x27;hex&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    return Decoder(buf, port);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">}*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lobaro/iot/tree/master/docs/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/iot/components/firmware/app-nrf9160-wmbus/configuration-parameter"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuration Parameter</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/iot/components/firmware/app-nrf9160-wmbus/cellular-iot-communication-protocol"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cellular IoT Communication</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#uplink-payload-formats">Uplink Payload Formats</a><ul><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#status-packet-port-1">Status Packet (Port 1)</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-0">Data Packet (PayloadFormat 0)</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-1">Data Packet (PayloadFormat 1)</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#data-packet-payloadformat-2">Data Packet (PayloadFormat 2)</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#examples-1">Examples</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#upload-speed--duration">Upload Speed / Duration</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#downlink-payload-formats">Downlink Payload Formats</a><ul><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#lorawan-downlink-ports">LoRaWAN Downlink Ports</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#remote-configuration">Remote Configuration</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#firmware-control-commands">Firmware Control Commands</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#decodewmbus">Decoding wMBUS telegrams</a></li><li><a class="table-of-contents__link toc-highlight" href="/iot/components/firmware/app-nrf9160-wmbus/lorawan-communication-protocol#example-js-parser">Example JS parser</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div style="font-size: small">Copyright © <a href="https://www.lobaro.de" target="_blank">Lobaro GmbH</a> 2024 | Stadtdeich 7 | D-20097 Hamburg | Germany | <a href="mailto:support@lobaro.de">support@lobaro.de</a> | <a href="https://www.lobaro.com/en/contact/" target="_blank">Legal Disclosure</a></div></div></div></div></footer></div>
</body>
</html>