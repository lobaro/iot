(self.webpackChunklobaro_docs=self.webpackChunklobaro_docs||[]).push([[7143],{2092:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/images/ideal-img/MBusWirelessLogo.c0cdf50.271.jpg 271w",images:[{path:n.p+"assets/images/ideal-img/MBusWirelessLogo.c0cdf50.271.jpg",width:271,height:97}],src:n.p+"assets/images/ideal-img/MBusWirelessLogo.c0cdf50.271.jpg",toString:function(){return n.p+"assets/images/ideal-img/MBusWirelessLogo.c0cdf50.271.jpg"},placeholder:void 0,width:271,height:97},preSrc:"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAEAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIH/8QAHxAAAgEEAgMAAAAAAAAAAAAAAQMCAAQFESEiMWGR/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAT/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oADAMBAAIRAxEAPwDcMxhF2IS+2vL5bZyLCYt12IO/A9n7UnJ5BBKYXrTFfQGQjI6HHJI5NKVZKtB//9k="}},3654:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.cfbd48e.300.jpg 300w,"+n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.4bfae49.600.jpg 600w,"+n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.6388cb0.900.jpg 900w,"+n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.c2ef6a1.1200.jpg 1200w",images:[{path:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.cfbd48e.300.jpg",width:300,height:157},{path:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.4bfae49.600.jpg",width:600,height:314},{path:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.6388cb0.900.jpg",width:900,height:471},{path:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.c2ef6a1.1200.jpg",width:1200,height:628}],src:n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.cfbd48e.300.jpg",toString:function(){return n.p+"assets/images/ideal-img/wmbus-gateway-bridge-lora-nb-iot.cfbd48e.300.jpg"},placeholder:void 0,width:300,height:157},preSrc:"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAFAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUH/8QAHhAAAgEEAwEAAAAAAAAAAAAAAQIDAAQFEQYhURP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/EABgRAAIDAAAAAAAAAAAAAAAAAAABAiEx/9oADAMBAAIRAxEAPwDaOExPa23IrhZWYfV5Sje6brfm6rYvKNc4y0naCMNLCjkAnolQfaUqzpsLD//Z"}},3969:(e,i,n)=>{"use strict";n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>A,frontMatter:()=>a,metadata:()=>t,toc:()=>d});var r=n(4848),s=n(8453);const a={sidebar_position:0,displayed_sidebar:"firmwareSidebar",title:"Introduction"},o="app-nrf9160-wmbus",t={id:"firmware/app-nrf9160-wmbus/introduction",title:"Introduction",description:"This page describes the Lobaro wireless M-Bus gateway firmware, called app-nrf9160-wmbus, which is executable on",source:"@site/docs/firmware/app-nrf9160-wmbus/introduction.md",sourceDirName:"firmware/app-nrf9160-wmbus",slug:"/firmware/app-nrf9160-wmbus/introduction",permalink:"/iot/firmware/app-nrf9160-wmbus/introduction",draft:!1,unlisted:!1,editUrl:"https://github.com/lobaro/iot/tree/master/docs/firmware/app-nrf9160-wmbus/introduction.md",tags:[],version:"current",sidebarPosition:0,frontMatter:{sidebar_position:0,displayed_sidebar:"firmwareSidebar",title:"Introduction"},sidebar:"firmwareSidebar",previous:{title:"Overview",permalink:"/iot/firmware/"},next:{title:"Configuration",permalink:"/iot/firmware/app-nrf9160-wmbus/configuration"}},l={},d=[{value:"Application Overview",id:"application-overview",level:2},{value:"Compatible Metering Protocols",id:"compatible-metering-protocols",level:2},{value:"Wireless M-BUS S1, C1 or T1",id:"wireless-m-bus-s1-c1-or-t1",level:3},{value:"Sensus RF Bubble UP",id:"sensus-rf-bubble-up",level:3},{value:"ME-Funk",id:"me-funk",level:3},{value:"Firmware Workflow",id:"firmware-workflow",level:2},{value:"CRON based Scans",id:"cron-based-scans",level:3},{value:"Daily Status Message",id:"daily-status-message",level:3}];function c(e){const i={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Image:a}=i;return a||function(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h1,{id:"app-nrf9160-wmbus",children:"app-nrf9160-wmbus"}),"\n",(0,r.jsxs)(i.p,{children:["This page describes the Lobaro wireless M-Bus gateway firmware, called ",(0,r.jsx)(i.code,{children:"app-nrf9160-wmbus"}),", which is executable on\ndifferent hardware variants which are in turn used to build different products. Nevertheless, this common description is\nvalid for all products independently which hardware it actually runs on."]}),"\n",(0,r.jsx)(i.h2,{id:"application-overview",children:"Application Overview"}),"\n",(0,r.jsx)(a,{alt:"Lobaro wireless M-BUS Gateway firmware",img:n(3654),style:{width:"70%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,r.jsx)(i.p,{children:"The Lobaro wireless M-Bus gateways collect consumption values from up to 650(*) commercially available water\nmeters, heat\nmeters, heat cost allocators or similar with 868 MHz wireless M-Bus radio interface, Sensus RF Bubble Up or M\xfcller Funk\nand forward them encrypted via NB-IoT or LTE-M cellular radio or alternatively LoRaWAN networks for further processing\non the Internet."}),"\n",(0,r.jsx)(i.p,{children:"Additionally, the gateway hardware may be equipped with a sensor addon board which can provide additional sensor\nmeasurement values beside the collected metering data. If an addon is present depends on the actual product running this\nfirmware."}),"\n",(0,r.jsx)(i.p,{children:"Forwarded meter values are transmitted, optionally additionally encrypted via DTLS, to a shared or private instance of\nthe Lobaro IoT platform and can be viewed there or downloaded as a CSV file. Alternatively, standardised APIs such as\nMQTT, HTTP Push, SFTP or a REST interface are available to connect downstream systems or platforms easily and securely.\nWhen using LoRaWAN, the Lobaro Platform is optional. When using NB-IoT or LTE-M, on the other hand, it is mandatory.\nThis requirement is explained in the Lobaro IoT Platform FAQ."}),"\n",(0,r.jsx)(i.p,{children:"Thanks to the new NB-IoT mobile radio, optimised for sensor data, remote reading even works in places such as basements\nwhere smartphones have poor or no reception."}),"\n",(0,r.jsx)(i.p,{children:"(*) based on average telegram size 75 Bytes. On request, the capacity for meter telegrams can be increased to up to\n2,500 by means of an additional built-in memory."}),"\n",(0,r.jsx)(i.h2,{id:"compatible-metering-protocols",children:"Compatible Metering Protocols"}),"\n",(0,r.jsx)(a,{alt:"Lobaro wireless M-BUS Gateway firmware",img:n(2092),style:{width:"20%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,r.jsx)(i.h3,{id:"wireless-m-bus-s1-c1-or-t1",children:"Wireless M-BUS S1, C1 or T1"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Unidirectional 868 MHz modes following DIN EN 13757-4."}),"\n",(0,r.jsx)(i.li,{children:"Open metering specification (OMS, Annex O): PHY_A - 868 MHz (uplink only)"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"sensus-rf-bubble-up",children:"Sensus RF Bubble UP"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Manufacturer specific radio protocol for 868 MHz (Xylem Inc.)."}),"\n",(0,r.jsx)(i.li,{children:"\u26a0\ufe0f Decoding of Sensus RF telegrams needs the Lobaro telegram parser and unfortunately can't be disclosed."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"me-funk",children:"ME-Funk"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:'A.k.a. "M\xfcller Funk" - Manufacturer specific radio protocol for 868 MHz (M\xfcller-electronic GmbH).'}),"\n",(0,r.jsx)(i.li,{children:"\u26a0\ufe0f Decoding of ME-Funk telegrams needs the Lobaro telegram parser and unfortunately can't be disclosed."}),"\n"]}),"\n",(0,r.jsxs)(i.admonition,{type:"info",children:[(0,r.jsx)(i.p,{children:"433 MHz variants are available on products equipped with the additional 433 MHz hardware addon for the following\nspecifications:"}),(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Wireless M-Bus, Open metering specification (OMS, Annex O): PHY_B - 433 MHz (uplink only)"}),"\n",(0,r.jsx)(i.li,{children:"Sensus RF Bubble UP 433 MHz - Manufacturer specific (Xylem Inc.) radio protocol"}),"\n"]})]}),"\n",(0,r.jsx)(i.h2,{id:"firmware-workflow",children:"Firmware Workflow"}),"\n",(0,r.jsx)(i.p,{children:"The firmware remains in power-saving mode while not active most of the time. It leaves the low power sleep mode in the\nfollowing situations:"}),"\n",(0,r.jsx)(i.h3,{id:"cron-based-scans",children:"CRON based Scans"}),"\n",(0,r.jsxs)(i.p,{children:["The firmware is configured by its ",(0,r.jsx)(i.code,{children:"listenCron"})," configuration parameter to wake up at regular intervals to collect / scan\nfor\nmetering\ntelegrams over its 868 MHz wireless interface. The following sequence of operations is executed on each cron triggering:"]}),"\n",(0,r.jsx)(i.admonition,{title:"CRON configuration parameter",type:"tip",children:(0,r.jsxs)(i.p,{children:[(0,r.jsxs)(i.a,{href:"/iot/configuration/cron-configuration",children:["Click here to learn more about ",(0,r.jsx)(i.strong,{children:"cron configuration"})," parameters"]}),"."]})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Wait in deep sleep low power mode for ",(0,r.jsx)(i.code,{children:"listenCron"})," to trigger"]}),"\n",(0,r.jsxs)(i.li,{children:["Collect metering data in all enabled wireless modes sequentially","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Collect C1-Mode and T1-Mode telegrams (wMBUS) in parallel for ",(0,r.jsx)(i.code,{children:"cmodeDurSec"})," seconds (if not 0)"]}),"\n",(0,r.jsxs)(i.li,{children:["Collect S1-Mode telegrams (wMBUS) for ",(0,r.jsx)(i.code,{children:"smodeDurSec"})," seconds (if not 0)"]}),"\n",(0,r.jsxs)(i.li,{children:["Collect X-Mode telegrams (Sensus RF) for ",(0,r.jsx)(i.code,{children:"xmodeDurSec"})," seconds (if not 0)"]}),"\n",(0,r.jsxs)(i.li,{children:["Collect U-Mode telegrams (M\xfcller Funk) for ",(0,r.jsx)(i.code,{children:"umodeDurSec"})," seconds (if not 0)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.li,{children:"Perform sensor measurement using the optional hardware addon (only if any addon installed)"}),"\n",(0,r.jsxs)(i.li,{children:["Upload all stored data via NB-IoT / LTE-CatM1 or LoRaWAN (depends on ",(0,r.jsx)(i.code,{children:"WAN"})," configuration)","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Upload all collected metering telegrams, status and sensor data"}),"\n",(0,r.jsxs)(i.li,{children:["When the upload fails the upload is retried every 24h after daily status or until the next ",(0,r.jsx)(i.code,{children:"listenCron"})," triggers."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["Sleep till next ",(0,r.jsx)(i.code,{children:"listenCron"})," triggers or status message upload."]}),"\n"]}),"\n",(0,r.jsx)(i.admonition,{type:"info",children:(0,r.jsx)(i.p,{children:"This sequence also will be executed one after any device startup oder manual reset."})}),"\n",(0,r.jsx)(i.admonition,{title:"Raw telegrams",type:"note",children:(0,r.jsxs)(i.p,{children:['All meter telegrams are received "as is", e.g. encrypted or plain over the air. Only the always readable telegram header\ninformation is parsed for internal filtering and deduplication. Parsing and decryption of such raw metering data happens\nin the backend, e.g. in\nthe Lobaro head end system or any other connected system.',(0,r.jsx)(i.br,{}),"\n","Lobaro offers a standalone ",(0,r.jsx)(i.a,{href:"https://www.mbus.org",children:"REST API"})," for raw wireless M-BUS telegrams parsing."]})}),"\n",(0,r.jsx)(i.h3,{id:"daily-status-message",children:"Daily Status Message"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Upload status telegram normally at midnight 0:00h (UTC+0)","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Solar-powered hardware variants: noon 12:00h (UTC+0)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.li,{children:"Upload remaining telegrams in memory, if any"}),"\n",(0,r.jsxs)(i.li,{children:["Sleep till next ",(0,r.jsx)(i.code,{children:"listenCron"})," or status telegram upload."]}),"\n"]})]})}function A(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{"use strict";n.d(i,{R:()=>o,x:()=>t});var r=n(6540);const s={},a=r.createContext(s);function o(e){const i=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:i},e.children)}}}]);