"use strict";(self.webpackChunklobaro_docs=self.webpackChunklobaro_docs||[]).push([[5588],{4138:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var n=i(4848),l=i(8453);const r={sidebar_position:2,title:"MBUS Reception Filtering"},s="MBUS Reception Filtering",a={id:"configuration/meter-reception-filter-config",title:"MBUS Reception Filtering",description:"Lobaro firmwares that can receive (wireless) M-BUS have (optional) common filter configuration parameter, that can limit, which telegrams are",source:"@site/docs/configuration/meter-reception-filter-config.md",sourceDirName:"configuration",slug:"/configuration/meter-reception-filter-config",permalink:"/iot/configuration/meter-reception-filter-config",draft:!1,unlisted:!1,editUrl:"https://github.com/lobaro/iot/tree/master/docs/configuration/meter-reception-filter-config.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"MBUS Reception Filtering"},sidebar:"allDocSidebar",previous:{title:"Lobaro Config Tool",permalink:"/iot/configuration/lobaro-config-tool"},next:{title:"LoRaWAN Downlink Config",permalink:"/iot/configuration/lorawan-downlink-config"}},o={},d=[{value:"Manufacturer filter",id:"manufacturer-filter",level:2},{value:"Examples for M-Field Codes",id:"examples-for-m-field-codes",level:3},{value:"Example for an <code>mFilter</code> whitelist",id:"example-for-an-mfilter-whitelist",level:3},{value:"Example for an <code>mFilter</code> blacklist:",id:"example-for-an-mfilter-blacklist",level:3},{value:"Device Type Filter",id:"device-type-filter",level:2},{value:"Examples for Device Type Codes",id:"examples-for-device-type-codes",level:3},{value:"Example for an <code>typFilter</code> whitelist",id:"example-for-an-typfilter-whitelist",level:3},{value:"Example for an <code>typFilter</code> blacklist:",id:"example-for-an-typfilter-blacklist",level:3},{value:"Device ID Filter",id:"device-id-filter",level:2},{value:"Example for an <code>devFilter</code> whitelist",id:"example-for-an-devfilter-whitelist",level:3},{value:"Example for an <code>devFilter</code> blacklist:",id:"example-for-an-devfilter-blacklist",level:3},{value:"CI Filter",id:"ci-filter",level:2},{value:"Telegrams with multiple layers",id:"telegrams-with-multiple-layers",level:2},{value:"Filtering Sensus RF (X-mode)",id:"filtering-sensus-rf-x-mode",level:2},{value:"Filtering M\xfcller Funk (U-mode)",id:"filtering-m\xfcller-funk-u-mode",level:2},{value:"Filtering Strategies",id:"filtering-strategies",level:2},{value:"Filter fine tuning using <code>maxTelegrams</code>",id:"filter-fine-tuning-using-maxtelegrams",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"mbus-reception-filtering",children:"MBUS Reception Filtering"})}),"\n",(0,n.jsx)(t.p,{children:"Lobaro firmwares that can receive (wireless) M-BUS have (optional) common filter configuration parameter, that can limit, which telegrams are\nprocessed by it. If\nfiltering is used, any telegram is checked against the filters immediately after it has been received. Only if the\ntelegram fits the criteria defined by all filters is it saved to the internal store and will be uploaded. All telegrams\nthat don't fit will be dropped and not processed further. This can be important to save bandwidth and battery life of a\ndevice. In many areas there will be many wMBus devices that send telegrams you are not interested in."}),"\n",(0,n.jsx)(t.p,{children:"There are four 4 common filter configuration parameter that are used in products / firmware with (wireless) MBUS collection abilities. These four filters check different aspects of a\ntelegram before storing it internally for later upload:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"mFilter"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Manufacturer filter \u2013 filters by the 3-letter manufacturer code that is present in every telegram (e.g. LOB for\nLobaro GmbH)."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"typFilter"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Device Type filter \u2013 filters by the 2-hex-digit code defining the nature of the sending device (e.g. 07 for water\nmeters)."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"devFilter"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Device filter \u2013 filters by the 8-digit ID, that is mandatory for each sending device (e.g. 87654321)."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ciFilter"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"CI-Field filter \u2013 filters by the 2-hex-digit CI-Field present in every telegram."}),"\n",(0,n.jsx)(t.li,{children:"That is a technical code describing the purpose of a telegram (e.g. 8a)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Each filter only checks for a single field of information in a telegram. If a filter is left blank, no filtering is done\nfor that field. So if you for example leave mFilter blank, there will be no filtering over the manufacturer of the\ndevice. Each filter is processed independently."}),"\n",(0,n.jsxs)(t.p,{children:['A filter is a simple whitelist for its field. If a telegram\'s value is listed in the filter, the telegram will be\ncollected. If not, it will be dropped. Entries in the list are separated by a single comma "," (no spaces!). If you add\na single exclamation\nmark "',(0,n.jsx)(t.code,{children:"!"}),'" in front of the list, the complete list will be treated as a blacklist.']}),"\n",(0,n.jsx)(t.h2,{id:"manufacturer-filter",children:"Manufacturer filter"}),"\n",(0,n.jsxs)(t.p,{children:["Each wMBus telegram has the manufacturer of the sending meter encoded as a 3-letter code assigned by the ",(0,n.jsx)(t.a,{href:"https://www.dlms.com/home",children:"DLMS User\nAssociation"}),". On their site you can find the complete list\nof ",(0,n.jsx)(t.a,{href:"https://www.dlms.com/flag-id-directory/",children:"manufacturer IDs"}),". The field in the telegram that holds this\ninformation is called M-Field. The M-Field for Lobaro is ",(0,n.jsx)(t.code,{children:"LOB"}),"."]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"Entries in this filter must be exactly 3 letters long. The case is ignored."})}),"\n",(0,n.jsx)(t.h3,{id:"examples-for-m-field-codes",children:"Examples for M-Field Codes"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"center"},children:"M-Code"}),(0,n.jsx)(t.th,{children:"Company"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"LOB"}),(0,n.jsx)(t.td,{children:"Lobaro GmbH, Hamburg, Germany"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"DME"}),(0,n.jsx)(t.td,{children:"Diehl Metering, Ansbach, Germany"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"QDS"}),(0,n.jsx)(t.td,{children:"Qundis GmbH, Erfurt, Germany"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"ARD"}),(0,n.jsx)(t.td,{children:"Arad Group Ltd, Dalia, Israel"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"SEN"}),(0,n.jsx)(t.td,{children:"Sensus Metering Systems, Ludwigshafen, Germany"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"SON"}),(0,n.jsx)(t.td,{children:"Sontex SA, Sonceboz, Switzerland"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"center"},children:"ITW"}),(0,n.jsx)(t.td,{children:"ITRON (Water), Issy-les-Moulineaux, France"})]})]})]}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-mfilter-whitelist",children:["Example for an ",(0,n.jsx)(t.code,{children:"mFilter"})," whitelist"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"mFilter"})," : ",(0,n.jsx)(t.code,{children:"SEN,ITW,DME"})," will collect only telegrams from meters by Sensus Metering, Itron (Water), and Diehl Metering.\nAll other\ntelegrams will be dropped."]}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-mfilter-blacklist",children:["Example for an ",(0,n.jsx)(t.code,{children:"mFilter"})," blacklist:"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"mFilter"})," : ",(0,n.jsx)(t.code,{children:"!SEN,ITW,DME"})," will drop any telegram from meters by Sensus Metering, Itron (Water), or Diehl Metering. Any\nother\nmanufacturer will be stored and uploaded."]}),"\n",(0,n.jsx)(t.h2,{id:"device-type-filter",children:"Device Type Filter"}),"\n",(0,n.jsx)(t.p,{children:"Each wMBus device is of a type (e.g. water meter, heat cost meter). The type is encoded as a 2-hex-digit number. The\nentries must be exactly 2 hex digits long, case is ignored."}),"\n",(0,n.jsx)(t.h3,{id:"examples-for-device-type-codes",children:"Examples for Device Type Codes"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-json",metastring:'title="Wireless M-BUS Device Codes (hex)"',children:'"00": "Other",\n"01": "Oil",\n"02": "Electricity",\n"03": "Gas",\n"04": "Heat",\n"05": "Steam",\n"06": "Warm Water", // 30 - 90\xb0C\n"07": "Water",\n"08": "Heat Cost",\n"09": "Compressed Air",\n"0A": "Cooling load meter (outlet)",\n"0B": "Cooling load meter (inlet)",\n"0C": "Heat (inlet)",\n"0D": "Heat / Cooling load meter",\n"0E": "Bus / System component",\n"0F": "Unknown",\n"10": "consumption meter",\n"11": "consumption meter",\n"12": "consumption meter",\n"13": "consumption meter",\n"14": "Calorific value",\n"15": "Hot Water", // >= 90\xb0C\n"16": "Cold Water",\n"17": "Dual Water meter", // Hot and Cold\n"18": "Pressure",\n"19": "A/D Converter",\n"1A": "Smoke detector",\n"1B": "Room", // e.g. temp, humidity\n"1C": "Gas detector",\n"1D": "Sensor",\n"1E": "Sensor",\n"1F": "Sensor",\n"20": "Breaker (electricity)",\n"21": "Valve (gas or water)",\n"22": "Switching device",\n"23": "Switching device",\n"24": "Switching device",\n"25": "Customer unit (display device)",\n"26": "Customer units",\n"27": "Customer units",\n"29": "Garbage",\n"2A": "Carbon dioxide",\n"30": "system device",\n"31": "Communication controller",\n"32": "Unidirectional repeater",\n"33": "Bidirectional repeater",\n"34": "system device",\n"35": "system device",\n"36": "Radio converter (system side)",\n"37": "Radio converter (meter side)"\n'})}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsx)(t.p,{children:"Usually the actual used device code that a specific meter uses can be found in its manual."})}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-typfilter-whitelist",children:["Example for an ",(0,n.jsx)(t.code,{children:"typFilter"})," whitelist"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"typFilter"})," = ",(0,n.jsx)(t.code,{children:"04"})]}),"\n",(0,n.jsxs)(t.p,{children:["Will receive only heat meters (",(0,n.jsx)(t.code,{children:"04"}),") telegrams."]}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-typfilter-blacklist",children:["Example for an ",(0,n.jsx)(t.code,{children:"typFilter"})," blacklist:"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"typFilter"})," = ",(0,n.jsx)(t.code,{children:"!08,07,F0,06,16,15,32,1A,80"})]}),"\n",(0,n.jsxs)(t.p,{children:["Will ",(0,n.jsx)(t.strong,{children:"not"})," receive any of the listed meter types."]}),"\n",(0,n.jsx)(t.h2,{id:"device-id-filter",children:"Device ID Filter"}),"\n",(0,n.jsxs)(t.p,{children:["Each wMBus device has an ",(0,n.jsx)(t.strong,{children:"8-digit device ID"})," or Address. This ID is normally printed on the device. The combination of\nManufacturer Code and Device ID should be globally unique. This is the most specific filter and can be used to tune the\nGateway to only collect telegram from individual devices. The amount of possible meters in the list depends is product\ndependend and ranges from 500 to 2.500 IDs, please check the actual product documentation or ask Lobaro."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"IDs for wireless M-BUS can omit leading zeros and are 1-8 digit long numbers."}),"\n",(0,n.jsx)(t.li,{children:"This filter also accepts 11-digit IDs for filtering Sensus-RF telegrams in X-mode."}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"The number of telegrams uploaded can be higher than the number of IDs in the whitelist, because some meters send out\nmultiple different telegrams."})}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-devfilter-whitelist",children:["Example for an ",(0,n.jsx)(t.code,{children:"devFilter"})," whitelist"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"devFilter"})," = ",(0,n.jsx)(t.code,{children:"88009035,13456035,56268931"})]}),"\n",(0,n.jsxs)(t.h3,{id:"example-for-an-devfilter-blacklist",children:["Example for an ",(0,n.jsx)(t.code,{children:"devFilter"})," blacklist:"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"devFilter"})," = ",(0,n.jsx)(t.code,{children:"!88009035,13456035,56268931"})]}),"\n",(0,n.jsx)(t.h2,{id:"ci-filter",children:"CI Filter"}),"\n",(0,n.jsx)(t.p,{children:"The CI-Field is a 2-hex-digit number that is used to encode type and purpose of a telegram. Some meters send multiple\ndifferent types of telegrams that can be identified by this field. Entries in this list must be exactly 2 hex digits\nlong, case is ignored."}),"\n",(0,n.jsx)(t.h2,{id:"telegrams-with-multiple-layers",children:"Telegrams with multiple layers"}),"\n",(0,n.jsx)(t.p,{children:"wMBus telegrams can have multiple headers in different layers. This can be the case if multiple devices are involved in\ncreating the telegram, because it is read from the actual meter by an attached device that sends it out. Telegrams with\nmultiple headers can have multiple different manufacturer codes, device types, and device IDs. These telegrams are\naccepted by a whitelist filter, if at least one of the values in the telegram is present in the whitelist. It will be\ndropped by a blacklist filter if at least one of the values from the telegram is present in the blacklist."}),"\n",(0,n.jsx)(t.h2,{id:"filtering-sensus-rf-x-mode",children:"Filtering Sensus RF (X-mode)"}),"\n",(0,n.jsxs)(t.p,{children:["X-mode is a special listening mode of the Gateway, that collects proprietary telegrams from meters by Sensus/Xylem. *\n",(0,n.jsx)(t.em,{children:"Only\nthe devFilter will be used on X-mode telegrams"}),"*. The IDs used for Sensus-RF meters are 11 digit long and written on the\nmeter in a format with dashes, like this: 1010-012-4411. To use the device filter for X-mode, add the meter IDs to the\nlist in devFilter without the dashes. Sensus-RF IDs must be entered using exactly 11 digits, e.g. 10100124411."]}),"\n",(0,n.jsx)(t.p,{children:"If the a single device uses X-mode together with any other mode (C/T, S, U), the devFilter is used for both. Any ID that\nhas 11 digits will be used for X-mode only. IDs with 1-8 digits will be used for all the other modes, but not for\nX-mode. If there are only 11-digit IDs in devFilter, it will be blank (= no device filter) for modes C/T, S, and U. If\nthere are only 1-to-8-digit IDs in devFilter, it will be blank (= no device filter) for X-mode."}),"\n",(0,n.jsx)(t.h2,{id:"filtering-m\xfcller-funk-u-mode",children:"Filtering M\xfcller Funk (U-mode)"}),"\n",(0,n.jsxs)(t.p,{children:["U-Mode is a special listening mode of the Gateway, that collects proprietary telegrams from meters by M\xfcller-electronic\nGmbH. ",(0,n.jsx)(t.strong,{children:"Only the devFilter will be used on U-mode telegrams, the other filters will be ignored."})," Device IDs for M\xfcller\nFunk\nhave the same format as in wMBus: 8 digits. When U-mode is used on a device that also uses C/T-mode or S-mode, put the\nIDs for both modes in the devFilter list. The IDs in the list will be used for both modes."]}),"\n",(0,n.jsx)(t.h2,{id:"filtering-strategies",children:"Filtering Strategies"}),"\n",(0,n.jsx)(t.p,{children:"There is no all-purpose-strategy for filtering. What is best for you will depend on your use cases."}),"\n",(0,n.jsx)(t.p,{children:"Setting an explicit device list for each of your Gateways will lead to the most efficient use of battery and bandwidth.\nBut it comes with huge administrative overload, as each Gateway will need an individually composed list. When new meters\nare installed, the list must also be updated."}),"\n",(0,n.jsxs)(t.p,{children:["For bigger role-outs it might be easier to work with device type filters. If you are only interested in water meters, a\n",(0,n.jsx)(t.code,{children:"typFilter"}),' set to "06,07,15,16,17" might be a sufficient setting for your bridges; it will filter out any head cost\nmeters and smoke detectors. Unintentionally received water meters can simply be ignored in the backend. A combination of\n',(0,n.jsx)(t.code,{children:"typFilter"})," and ",(0,n.jsx)(t.code,{children:"mFilter"})," will often reduce the number of unwanted telegrams sufficiently."]}),"\n",(0,n.jsx)(t.p,{children:"Individual tuning can be done by initially installing a gateway with no filters configured. After the first uploads, the\nwanted telegrams can be identified in the backend, and filters can then be created and sent to the gateway way remote\nconfiguration downlink."}),"\n",(0,n.jsx)(t.p,{children:"If the Gateway uploads telegrams that you do not want, you can put each unwanted meter on the device blacklist via\nremote configuration."}),"\n",(0,n.jsxs)(t.h3,{id:"filter-fine-tuning-using-maxtelegrams",children:["Filter fine tuning using ",(0,n.jsx)(t.code,{children:"maxTelegrams"})]}),"\n",(0,n.jsxs)(t.p,{children:["The reception time the Gateway for collecting wMBus telegrams can be minimised by a combination of filters and\nmaxTelegrams. If maxTelegrams is set to a number different than 0, the Gateway will stop collection and start uploading\nas soon as that many telegrams are in the store. Set the the IDs of all wanted Meters in devFilter and\nset ",(0,n.jsx)(t.code,{children:"maxTelegrams"}),"\nto the number of telegrams you expect. Be aware, that some devices will send out multiple different telegrams. Set\nmaxTelegrams accordingly."]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>a});var n=i(6540);const l={},r=n.createContext(l);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);