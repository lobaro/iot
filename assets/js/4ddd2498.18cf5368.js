(self.webpackChunklobaro_docs=self.webpackChunklobaro_docs||[]).push([[1110],{7366:(e,n,i)=>{e.exports={src:{srcSet:i.p+"assets/images/ideal-img/3F-result-in-ascii.c89288d.619.png 619w",images:[{path:i.p+"assets/images/ideal-img/3F-result-in-ascii.c89288d.619.png",width:619,height:648}],src:i.p+"assets/images/ideal-img/3F-result-in-ascii.c89288d.619.png",toString:function(){return i.p+"assets/images/ideal-img/3F-result-in-ascii.c89288d.619.png"},placeholder:void 0,width:619,height:648},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAIAAAACUFjqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABDUlEQVR4nCXOzU/CMBiA8f7/B4/eTSQSNHLQSDwoJhrR3fTAh4DuA9aObv0eHeu71qDJL8/5QUIqIRQXSiptdK20aZqDc9C2znuPKEkYzRhNJcNaEC2I4ljyXHJca4rI9qvAsWS5NdRILKrUGmrNztalYgkaj0fnF73BVX81j1S5YGTKixkvjmXFFJHtIksWaTwn2zUv04omvMok24gqE+UPsjUH8G3rjjsOALoQQvA+hNBYgWpTAjhwhw7aDlzX/Wu972zNkKHJge+sxtBQsHSvsJH5HyyrGN1/3vSi3kv0FL29TibPRb7cq43miRGZLNfo9vHsdHhyN+w/DK9Hl4PVx3tF4wKvd+SbkuUv4kcPHFiK110AAAAASUVORK5CYII="}},8207:(e,n,i)=>{e.exports={src:{srcSet:i.p+"assets/images/ideal-img/Downlink-TTN-get-fw.b7f06e1.882.png 882w",images:[{path:i.p+"assets/images/ideal-img/Downlink-TTN-get-fw.b7f06e1.882.png",width:882,height:660}],src:i.p+"assets/images/ideal-img/Downlink-TTN-get-fw.b7f06e1.882.png",toString:function(){return i.p+"assets/images/ideal-img/Downlink-TTN-get-fw.b7f06e1.882.png"},placeholder:void 0,width:882,height:660},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcUlEQVR4nG2MMQ7CMBAE/f9v0fAMilAgpAT7Ysu+27tFcYEAZTTdSJNIam35du8vcQYAdwcQESSTmW7PteXKM5KaSd1V1d1P8iili9h8xuQnN9nrfpwj/p3znEcTNfQBA789ctna9bI8ljUCZgrYR5JvSz7Nn8r84TIAAAAASUVORK5CYII="}},2571:(e,n,i)=>{e.exports={src:{srcSet:i.p+"assets/images/ideal-img/lorawan-downlink-3F-answer.4bc9c29.1378.png 1378w",images:[{path:i.p+"assets/images/ideal-img/lorawan-downlink-3F-answer.4bc9c29.1378.png",width:1378,height:31}],src:i.p+"assets/images/ideal-img/lorawan-downlink-3F-answer.4bc9c29.1378.png",toString:function(){return i.p+"assets/images/ideal-img/lorawan-downlink-3F-answer.4bc9c29.1378.png"},placeholder:void 0,width:1378,height:31},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAKklEQVR4nAEfAOD/APLy8vDw8Pb29vLx8fH09O3Z2ea3t/Du7vHy8vPz86+eG6M4AoFrAAAAAElFTkSuQmCC"}},4513:(e,n,i)=>{e.exports={src:{srcSet:i.p+"assets/images/ideal-img/lorawan-downlink-3F-downlink.80f3eb1.634.png 634w",images:[{path:i.p+"assets/images/ideal-img/lorawan-downlink-3F-downlink.80f3eb1.634.png",width:634,height:45}],src:i.p+"assets/images/ideal-img/lorawan-downlink-3F-downlink.80f3eb1.634.png",toString:function(){return i.p+"assets/images/ideal-img/lorawan-downlink-3F-downlink.80f3eb1.634.png"},placeholder:void 0,width:634,height:45},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAIAAABol6gpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAHklEQVR4nGP4+vXrly9fPsPAz58/ISLfvn379OkTALwKHKViCz9TAAAAAElFTkSuQmCC"}},9834:(e,n,i)=>{e.exports={src:{srcSet:i.p+"assets/images/ideal-img/ttn-downlink.307b73d.1081.png 1081w",images:[{path:i.p+"assets/images/ideal-img/ttn-downlink.307b73d.1081.png",width:1081,height:370}],src:i.p+"assets/images/ideal-img/ttn-downlink.307b73d.1081.png",toString:function(){return i.p+"assets/images/ideal-img/ttn-downlink.307b73d.1081.png"},placeholder:void 0,width:1081,height:370},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAS0lEQVR4nEXLUQqAMAwD0N3/lB5AUBHWpNsaaUEtPPKRtO3nJZCKiDLnFEmttT7urtZ7ryIHY4zK9F4+O6kGUAbIzAoMAn7ZbfehB1MfdZx0etnTAAAAAElFTkSuQmCC"}},8723:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"configuration/lorawan-downlink-config","title":"LoRaWAN Downlink Config","description":"This article describes the technical details how to remotely configure Lobaro devices that are using LoRaWAN as","source":"@site/docs/configuration/lorawan-downlink-config.md","sourceDirName":"configuration","slug":"/configuration/lorawan-downlink-config","permalink":"/iot/configuration/lorawan-downlink-config","draft":false,"unlisted":false,"editUrl":"https://github.com/lobaro/iot/tree/master/docs/configuration/lorawan-downlink-config.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"LoRaWAN Downlink Config"},"sidebar":"allDocSidebar","previous":{"title":"MBUS Reception Filtering","permalink":"/iot/configuration/meter-reception-filter-config"},"next":{"title":"CRON Configuration","permalink":"/iot/configuration/cron-configuration"}}');var o=i(4848),a=i(8453);const s={sidebar_position:3,title:"LoRaWAN Downlink Config"},r="LoRaWAN Downlink Config",d={},l=[{value:"Protocol Description",id:"protocol-description",level:2},{value:"Downlink Commands (Port 128)",id:"downlink-commands-port-128",level:3},{value:"<code>?</code>",id:"",level:4},{value:"<code>g&lt;name&gt;</code>",id:"gname",level:4},{value:"<code>r&lt;name&gt; / r*</code>",id:"rname--r",level:4},{value:"<code>s&lt;name&gt;=&lt;value&gt;</code>",id:"snamevalue",level:4},{value:"<code>a&lt;name&gt;=&lt;value&gt;</code>",id:"anamevalue",level:4},{value:"<code>b</code>",id:"b",level:4},{value:"<code>w or wFORCE</code>",id:"w-or-wforce",level:4},{value:"Examples",id:"examples",level:2},{value:"Changing device configuration",id:"changing-device-configuration",level:3},{value:"Downlink on TTN",id:"downlink-on-ttn",level:4},{value:"Getting the firmware version",id:"getting-the-firmware-version",level:3},{value:"Downlink on TTN",id:"downlink-on-ttn-1",level:4},{value:"Uplink on TTN",id:"uplink-on-ttn",level:4},{value:"Configure a device via script",id:"configure-a-device-via-script",level:3},{value:"Example configuration command to be send",id:"example-configuration-command-to-be-send",level:4},{value:"Curl Script for TTN",id:"curl-script-for-ttn",level:4},{value:"Chirpstack V3",id:"chirpstack-v3",level:4},{value:"Chirpstack V4",id:"chirpstack-v4",level:4}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components},{Image:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"lorawan-downlink-config",children:"LoRaWAN Downlink Config"})}),"\n",(0,o.jsxs)(n.p,{children:["This article describes the technical details how to remotely configure Lobaro devices that are using ",(0,o.jsx)(n.strong,{children:"LoRaWAN"})," as\nupload technology."]}),"\n",(0,o.jsx)(n.p,{children:"IoT devices are often installed at places that are difficult to reach. If you need to change the settings of such a\ndevice it is often not easily possible to get physical access to attach a config adapter."}),"\n",(0,o.jsx)(n.p,{children:"Many of our devices support LoRaWAN remote configuration that allows you to change the configuration of the device by\nsending downlink messages."}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"If you are using cellular IoT (NB-IoT, LTE-M) as communication technology any configuration updates are done in a\ndifferent way."})}),"\n",(0,o.jsx)(n.h2,{id:"protocol-description",children:"Protocol Description"}),"\n",(0,o.jsxs)(n.p,{children:["Lobaro LoRaWAN devices receive remote configuration commands as Downlinks on port 128. Responses to those commands will\nbe sent as Uplinks on ",(0,o.jsx)(n.code,{children:"Port 128"})," (and 129-131 for long responses). ",(0,o.jsx)(n.strong,{children:"The remote commands and their responses are all\nencoded in ASCII"}),", to make it easier for humans to use them. The ASCII string must be converted to hex or Base64\npayload bytes, depending on the used LoRaWAN network server."]}),"\n",(0,o.jsxs)(n.p,{children:["The first byte of a Downlink message on ",(0,o.jsx)(n.code,{children:"Port 128"})," contains a single character that identifies the command you want to\nsend. Some commands take a parameter following the command char."]}),"\n",(0,o.jsx)(n.p,{children:"The responses to a command start with the same character as the command followed by an optional parameter. If a command\nis unknown, or it fails for some reason, an error response is sent via Uplink that contains with a ! followed by a\nreadable error message."}),"\n",(0,o.jsx)(n.p,{children:"Changing configuration does nothing until you save the changes and reboot the device. The device has a safety feature\nthat prevents configurations that make the device unusable. A new configuration is tested in the first run after\nrebooting. Only after the device reaches a stable state will the configuration be adopted and used permanently. If a\nproblem occurs the device will restore its last stable connection and reboot. If the device uses OTAA (which we\nrecommend) the device will only adopt the new configuration only after a join request is accepted, to make sure the\nLoRaWAN parameters are correct. After a few failed attempts it will restore the previous configuration. This can take up\nto about 10 minutes."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Downlinks should only be used to a limited extent depending on the infrastructure. In the free version of TTN, the Fair\nuse policy says, that no more than 10 downlinks should be made. You also have to observe the regulations within the\nLimit of the duty cycle limitation. That is why downlinks are only to be carried out with caution and when absolutely\nnecessary. The number of possible characters that can be sent is limited by the respective spreading factor (With a SF\nof 12 only 51 characters)."})}),"\n",(0,o.jsx)(n.h3,{id:"downlink-commands-port-128",children:"Downlink Commands (Port 128)"}),"\n",(0,o.jsxs)(n.p,{children:["Configurations are normally communicated as downlinks and uplinks (responses) on ",(0,o.jsx)(n.code,{children:"Port 128"}),". For longer responses, that\ndon't can be send as single uplink on ",(0,o.jsx)(n.code,{children:"Port 128"}),", the ",(0,o.jsx)(n.code,{children:"Ports 129-131"})," are used. The first response part is sent\non ",(0,o.jsx)(n.code,{children:"Port 129"}),", the middle parts (if exist) on ",(0,o.jsx)(n.code,{children:"Port 130"})," and the last part on ",(0,o.jsx)(n.code,{children:"Port 131"}),". A stateful parser can\nconcatenate long responses based on Port and FCnt."]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Char"}),(0,o.jsx)(n.th,{children:"Command"}),(0,o.jsx)(n.th,{children:"Parameter"}),(0,o.jsx)(n.th,{children:"HEX"}),(0,o.jsx)(n.th,{children:"Info"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"?"}),(0,o.jsx)(n.td,{children:"Request firmware and version"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"None             "})}),(0,o.jsx)(n.td,{children:"3F"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"a"}),(0,o.jsx)(n.td,{children:"Append to config parameter val"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"<name>=<value>   "})}),(0,o.jsx)(n.td,{children:"61"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"b"}),(0,o.jsx)(n.td,{children:"Reboot device without saving"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"None             "})}),(0,o.jsx)(n.td,{children:"62"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"g"}),(0,o.jsx)(n.td,{children:"Get config parameter value"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Name of parameter"})}),(0,o.jsx)(n.td,{children:"67"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"r"}),(0,o.jsx)(n.td,{children:"Reset config parameter value"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Name of parameter"})}),(0,o.jsx)(n.td,{children:"72"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"s"}),(0,o.jsx)(n.td,{children:"Set config parameter value"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"<name>=<value>   "})}),(0,o.jsx)(n.td,{children:"73"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"S"}),(0,o.jsx)(n.td,{children:"Set config parameter value & Save and reboot"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"<name>=<value>   "})}),(0,o.jsx)(n.td,{children:"53"}),(0,o.jsx)(n.td,{children:"Not supported on all devices"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"w"}),(0,o.jsx)(n.td,{children:"Save config and reboot device"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"None             "})}),(0,o.jsx)(n.td,{children:"77"}),(0,o.jsx)(n.td,{})]})]})]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"Depending on the firmware version not all commands might be supported on all devices.\nPlease refer to the manual of your product for more details."})}),"\n",(0,o.jsx)(n.h4,{id:"",children:(0,o.jsx)(n.code,{children:"?"})}),"\n",(0,o.jsx)(n.p,{children:"Request firmware and version. This command triggers the device to send what firmware it is running and in which version.\nThis can be used to test if the remote configuration is working."}),"\n",(0,o.jsx)(n.h4,{id:"gname",children:(0,o.jsx)(n.code,{children:"g<name>"})}),"\n",(0,o.jsxs)(n.p,{children:["Get the value of the config parameter ",(0,o.jsx)(n.code,{children:"<name>"}),". This command makes the device sent a response\ncontaining ",(0,o.jsx)(n.code,{children:"<name>=<value>"})," as\nparameter giving you the current value of a configuration parameter."]}),"\n",(0,o.jsx)(n.h4,{id:"rname--r",children:(0,o.jsx)(n.code,{children:"r<name> / r*"})}),"\n",(0,o.jsxs)(n.p,{children:["Reset config parameter ",(0,o.jsx)(n.code,{children:"<name>"})," to its default value. As a confirmation the device sends a response\ncontaining ",(0,o.jsx)(n.code,{children:"<name>=<value>"}),", reporting the new value of the parameter.Sending the special value * will reset all config\nparameters."]}),"\n",(0,o.jsx)(n.h4,{id:"snamevalue",children:(0,o.jsx)(n.code,{children:"s<name>=<value>"})}),"\n",(0,o.jsxs)(n.p,{children:["Set config parameter ",(0,o.jsx)(n.code,{children:"<name>"})," to ",(0,o.jsx)(n.code,{children:"<value>"}),". Sets the parameter to the value given in the parameter. As a confirmation it\nsends a response containing ",(0,o.jsx)(n.code,{children:"<name>=<value>"}),", reporting the new value of the parameter."]}),"\n",(0,o.jsx)(n.h4,{id:"anamevalue",children:(0,o.jsx)(n.code,{children:"a<name>=<value>"})}),"\n",(0,o.jsxs)(n.p,{children:["Append ",(0,o.jsx)(n.code,{children:"<value>"})," to the config parameter ",(0,o.jsx)(n.code,{children:"<name>"}),". This command appends the value given to the current value of the\nparameter. This is intended to allow setting values that are too long for a single Downlink message. As a confirmation\nit sends the length of the config parameter's value after the appending. Append works for config parameters of type\nstring."]}),"\n",(0,o.jsx)(n.h4,{id:"b",children:(0,o.jsx)(n.code,{children:"b"})}),"\n",(0,o.jsx)(n.p,{children:"Reboot device without saving. This command restarts the device. Any changes too the config that have been committed\nbefore will be lost! This command does not send a Response."}),"\n",(0,o.jsx)(n.h4,{id:"w-or-wforce",children:(0,o.jsx)(n.code,{children:"w or wFORCE"})}),"\n",(0,o.jsx)(n.p,{children:"Save config and reboot device. This command saves all configuration changes to a temporarily configuration and restarts\nthe device. Only if the device boots successfully and reaches normal operation mode is the new configuration made\npermanent. If any fatal configuration error occurs or if the LoRaWAN OTAA Join does not succeed, the previous\nconfiguration will be restored and the device restarted again. This command does not send a Response.If you add the\nspecial argument FORCE to the command, the configuration will be made permanent without testing the configuration."}),"\n",(0,o.jsxs)(n.admonition,{type:"danger",children:[(0,o.jsxs)(n.p,{children:["Using ",(0,o.jsx)(n.strong,{children:"wFORCE"})," can leave your device useless and unreachable!"]}),(0,o.jsxs)(n.p,{children:["Do not use ",(0,o.jsx)(n.strong,{children:"wFORCE"})," unless you have a very good reason. If the device is set to an invalid configuration it will no\nlonger\nbe reachable by the Network Server. From such a state it can only be recovered with physical access and a config\nadapter. It will also most likely drain the battery quickly."]})]}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsxs)(n.p,{children:["For commands ",(0,o.jsx)(n.code,{children:"s"}),", ",(0,o.jsx)(n.code,{children:"S"})," and ",(0,o.jsx)(n.code,{children:"a"})," make sure the number of characters to send matches with the possibilities your devices\nspreading factor:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"SF 7 = 242 bytes max. LoRaWAN downlink payload"}),"\n",(0,o.jsx)(n.li,{children:"SF 12 = 51 bytes max. LoRaWAN downlink payload"}),"\n"]}),(0,o.jsx)(n.p,{children:"Consider splitting bigger configuration changed in multiple smaller downlinks."})]}),"\n",(0,o.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsx)(n.h3,{id:"changing-device-configuration",children:"Changing device configuration"}),"\n",(0,o.jsx)(n.p,{children:"The following is a short example of how you can update two configuration values remotely (that includes rebooting the\ndevice)."}),"\n",(0,o.jsx)(n.p,{children:"Most LoRaWAN devices (all that are running in Class A, which are by fast the most) can only be reached when they contact\nthe network. Network Servers (like The Things Network) provide a mechanism to enqueue messages for a specific device.\nThe messages will be sent as downlink the next time that device contacts the network. Normally, multiple messages can be\nenqueued and will all be transmitted as soon as possible. Please be advised that the gateways communicating with your\ndevice must respect their duty cycle, so there is a very limited amount of downlinks that can be sent for a given time (\ndownlinks are expensive)."}),"\n",(0,o.jsx)(n.p,{children:"For this example we want to set Time Synchronization to sync the internal clock every 10 days, and we want to deactivate\nAdaptive Date Rate (ADR). These are both LoRaWAN configuration parameters that are present on most devices (find details\nunder LoRaWAN Configuration), but you can of course also change parameters specific to your device, e.g. Modbus\nconfiguration or wMBus configuration, with this feature."}),"\n",(0,o.jsx)(n.p,{children:"We will need to send three commands:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"s"}),"TimeSync=10","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"set time synchronization to 10 day interval"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"s"}),"ADR=false","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"disable adaptive data rate"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"w"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"write changes to device configuration and reboot"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The actual s-commands will of course differ for your case, but the w command at the end ",(0,o.jsx)(n.strong,{children:"must"})," always be the same."]}),"\n",(0,o.jsx)(n.p,{children:"After sending the final command, the device will reboot and try the new configuration. If the boot process and the\nconnection to the network are successful, the device will make the changes permanent. If there is a problem (if you\naccidentally set an invalid value, e.g. sADR=flase or if you changed your AppKey to wrong value and your OTAA fails),\nthe device will revert to the previous configuration."}),"\n",(0,o.jsx)(n.h4,{id:"downlink-on-ttn",children:"Downlink on TTN"}),"\n",(0,o.jsx)(n.p,{children:"How you sent your downlinks depends on the LoRaWAN Network Server you use to connect your devices. You will most likely\nneed to convert the commands (that are all ASCII) to some different representation, e.g. Hex or Base64."}),"\n",(0,o.jsx)(n.p,{children:'In The Things Network you find the downlink panel on the "Device Overview" page for each device, directly below the\npanel that shows you OTAA/ABP information (DevEUI, AppKey, ...). It is shown in the following screenshot.'}),"\n",(0,o.jsx)(t,{alt:"TTN LoRaWAN downlink configuration",img:i(9834),style:{width:"60%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,o.jsxs)(n.p,{children:["You will have to encode the commands in hex. In the screenshot you see ",(0,o.jsx)(n.code,{children:"73 54 69 6d 65 53 79 6e 63 3d 31 30"})," as the\nmessage to send; that is the hex representation of ",(0,o.jsx)(n.code,{children:"sTimeSync=10"}),". The Port used for remote configuration for our\ndevices\nis 128. When you enter multiple messages to send, be sure to set the correct scheduling (last). The preselected replace\nwill overwrite your previously enqueued messages."]}),"\n",(0,o.jsx)(n.h3,{id:"getting-the-firmware-version",children:"Getting the firmware version"}),"\n",(0,o.jsxs)(n.p,{children:['For this example the "Request firmware and version" ',(0,o.jsx)(n.code,{children:"?"})," (0x3F) command has to used. We use TTN as network server."]}),"\n",(0,o.jsx)(n.h4,{id:"downlink-on-ttn-1",children:"Downlink on TTN"}),"\n",(0,o.jsx)(t,{alt:"TTN LoRaWAN downlink get firmware version",img:i(8207),style:{width:"50%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,o.jsx)(n.p,{children:"Will result in:"}),"\n",(0,o.jsx)(t,{alt:"TTN LoRaWAN downlink get firmware version",img:i(4513),style:{width:"50%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,o.jsx)(n.h4,{id:"uplink-on-ttn",children:"Uplink on TTN"}),"\n",(0,o.jsx)(n.p,{children:"The device answers with this uplink:"}),"\n",(0,o.jsx)(t,{alt:"TTN LoRaWAN uplink get firmware version",img:i(2571),style:{width:"95%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,o.jsxs)(n.p,{children:["This response can be converted to ASCII again, e.g. using\nany ",(0,o.jsx)(n.a,{href:"https://www.rapidtables.com/convert/number/hex-to-ascii.html",children:"online converter"}),":"]}),"\n",(0,o.jsx)(t,{alt:"TTN LoRaWAN uplink to ascii conversion get firmware version",img:i(7366),style:{width:"30%",paddingTop:"5px",paddingBottom:"5px"}}),"\n",(0,o.jsxs)(n.p,{children:["The result is: ",(0,o.jsx)(n.code,{children:"?app-hybrid-modbus v0.4.0+battery"})]}),"\n",(0,o.jsx)(n.h3,{id:"configure-a-device-via-script",children:"Configure a device via script"}),"\n",(0,o.jsx)(n.h4,{id:"example-configuration-command-to-be-send",children:"Example configuration command to be send"}),"\n",(0,o.jsxs)(n.p,{children:["Example command (ASCII encoding):",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.code,{children:"SMbCmd=0 0/10 * * * *:R,9600,8N1:010300160002,010300260002,fa0400050001"})]}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsxs)(n.p,{children:["For commands ",(0,o.jsx)(n.code,{children:"s"}),", ",(0,o.jsx)(n.code,{children:"S"})," and ",(0,o.jsx)(n.code,{children:"a"})," make sure the number of characters to send matches with the possibilities your devices\nspreading factor:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"SF 7 = 242 bytes max. LoRaWAN downlink payload"}),"\n",(0,o.jsx)(n.li,{children:"SF 12 = 51 bytes max. LoRaWAN downlink payload"}),"\n"]}),(0,o.jsx)(n.p,{children:"Consider splitting bigger configuration changed in multiple smaller downlinks."})]}),"\n",(0,o.jsxs)(n.p,{children:["Example command (Base64 encoding):",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.code,{children:"U01iQ21kPTAgMC8xMCAqICogKiAqOlIsOTYwMCw4TjE6MDEwMzAwMTYwMDAyLDAxMDMwMDI2MDAwMixmYTA0MDAwNTAwMDE="})]}),"\n",(0,o.jsx)(n.h4,{id:"curl-script-for-ttn",children:"Curl Script for TTN"}),"\n",(0,o.jsx)(n.p,{children:"Curl script to be used with TTN:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl --location \\ --header 'Authorization: Bearer NNSXS.XJAZK3VF3YBMXX_API_KEY_KR2HFG6ABXXXXXX.CP4WZUOXXXXXXXB5WW4UUSMNXRLUJ7LVO2U' \\\n--header 'Content-Type: application/json' \\\n--header 'User-Agent: my-integration/my-integration-version' \\\n--request POST \\ --data '{\"downlinks\":[{ \"frm_payload\":\n\"U01iQ21kPTAgMC8xMCAqICogKiAqOlIsOTYwMCw4TjE6MDEwMzAwMTYwMDAyLDAxMDMwMDI2MDAwMixmYTA0MDAwNTAwMDE=\",\n\"f_port\":128 }] }' \\\n'https://eu1.cloud.thethings.network/api/v3/as/applications/your-ttn-applicationID/devices/eui-your_TTN_end_deviceID/down/push'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["See also:  ",(0,o.jsx)(n.a,{href:"https://www.thethingsindustries.com/docs/integrations/webhooks/scheduling-downlinks/",children:"https://www.thethingsindustries.com/docs/integrations/webhooks/scheduling-downlinks/"})]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"You should use your own data for the API KEY, your-ttn-applicationID and your your_TTN_end_deviceID"})}),"\n",(0,o.jsx)(n.h4,{id:"chirpstack-v3",children:"Chirpstack V3"}),"\n",(0,o.jsx)(n.p,{children:"Curl script to be used with Chirpstack V3:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X POST --header 'Content-Type: application/json'\n--header 'Accept: application/json'\n--header 'Grpc-Metadata-Authorization:\nBearer xxxxxxxxx_API_KEY_xxxxxxx' -d\n'{ \"deviceQueueItem\": { \"confirmed\": false, \"data\":\n\"U01iQ21kPTAgMC8xMCAqICogKiAqOlIsOTYwMCw4TjE6MDEwMzAwMTYwMDAyLDAxMDMwMDI2MDAwMixmYTA0MDAwNTAwMDE=\",\n\"fPort\": 128\n } }'\n'http://192.198.0.101:8080/api/devices/ChirpStack_DevEUI/queue'\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"You should use your own data for the API KEY, your Chirpstack_IP_Adress and your your_ChirpStack_DevEUI"})}),"\n",(0,o.jsx)(n.h4,{id:"chirpstack-v4",children:"Chirpstack V4"}),"\n",(0,o.jsx)(n.p,{children:'The actual API has now switched from the Swagger API with UI to gRPC integration, but for compatibility and transition\nreasons the chirpstack-rest-api can be installed as an additional component. However, experience has shown that there\nare changes that need to be considered. "deviceQueueItem" became ""queueItem" and by default the API can now be reached\non port 8090 and no longer 8080.'}),"\n",(0,o.jsx)(n.p,{children:"Curl script to be used with Chirpstack V4:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X POST --header 'Content-Type: application/json'\n--header 'Accept: application/json'\n--header 'Grpc-Metadata-Authorization:\nBearer xxxxxxxxx_API_KEY_xxxxxxx' -d\n'{ \"queueItem\": { \"confirmed\": false, \"data\":\n\"U01iQ21kPTAgMC8xMCAqICogKiAqOlIsOTYwMCw4TjE6MDEwMzAwMTYwMDAyLDAxMDMwMDI2MDAwMixmYTA0MDAwNTAwMDE=\",\n\"fPort\": 128\n } }'\n'http://192.198.0.101:8090/api/devices/ChirpStack_DevEUI/queue'\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{"use strict";i.d(n,{R:()=>s,x:()=>r});var t=i(6540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);