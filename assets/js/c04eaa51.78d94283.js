"use strict";(self.webpackChunklobaro_docs=self.webpackChunklobaro_docs||[]).push([[2259],{2043:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>a,toc:()=>t});var o=i(4848),s=i(8453);const d={toc_max_heading_level:4},r="Downlinks",a={id:"platform/devices/downlinks",title:"Downlinks",description:"Everybody* read access",source:"@site/docs/platform/devices/downlinks.md",sourceDirName:"platform/devices",slug:"/platform/devices/downlinks",permalink:"/iot/platform/devices/downlinks",draft:!1,unlisted:!1,editUrl:"https://github.com/lobaro/iot/tree/master/docs/platform/devices/downlinks.md",tags:[],version:"current",frontMatter:{toc_max_heading_level:4},sidebar:"allDocSidebar",previous:{title:"Devices",permalink:"/iot/platform/devices/"},next:{title:"Hosting & Licensing",permalink:"/iot/platform/license/"}},l={},t=[{value:"Downlink Types",id:"downlink-types",level:2},{value:"Config",id:"config",level:3},{value:"Firmware",id:"firmware",level:3},{value:"Update secure boot and app firmware",id:"update-secure-boot-and-app-firmware",level:4},{value:"Update only app Firmware",id:"update-only-app-firmware",level:4},{value:"Update only secure boot Firmware",id:"update-only-secure-boot-firmware",level:4},{value:"Update modem firmware (detla)",id:"update-modem-firmware-detla",level:4},{value:"Lobaro Device Specific Downlinks",id:"lobaro-device-specific-downlinks",level:3},{value:"Reboot Device",id:"reboot-device",level:4},{value:"Comment / Test",id:"comment--test",level:4},{value:"LoRaWAN Downlinks",id:"lorawan-downlinks",level:3},{value:"Chirpstack specifics",id:"chirpstack-specifics",level:4},{value:"Raw Format",id:"raw-format",level:3},{value:"Tekelek Devices",id:"tekelek-devices",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"downlinks",children:"Downlinks"}),"\n",(0,o.jsx)(n.admonition,{title:"Required roles",type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Everybody"})," read access"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"device-admin"})," write access"]}),"\n"]})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"img.png",src:i(3855).A+"",width:"915",height:"692"})}),"\n",(0,o.jsx)(n.h2,{id:"downlink-types",children:"Downlink Types"}),"\n",(0,o.jsx)(n.p,{children:"There are different downlink Types to be queued. For each type, there can only be one downlink queued at a time.\nWhen queuing a new downlink of the same type, the existing one will be overwritten."}),"\n",(0,o.jsxs)(n.p,{children:["Each downlink need a ",(0,o.jsx)(n.code,{children:"type"})," and ",(0,o.jsx)(n.code,{children:"data"})," field.\nThe ",(0,o.jsx)(n.code,{children:"type"})," field is only used in the platform and not communicated with the device."]}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.strong,{children:"JSON Format"})," in the examples might be subject to ",(0,o.jsx)(n.strong,{children:"change in future"})," and might ",(0,o.jsx)(n.strong,{children:"differ between devices"}),"."]})}),"\n",(0,o.jsx)(n.h3,{id:"config",children:"Config"}),"\n",(0,o.jsx)(n.p,{children:'Update config values of the device. Lobaro Devices will verify the new configuration (including a backend connection).\nIf the config is invalid it will be rolled back to the previous state and a "Config Error" will be reported.'}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"config"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Example Data:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": {\n    "mFilter": "LOB",\n    "listenCron": "0 0/20 * * * *",\n    "cmodeDurSec": "600"\n  },\n  "q": "config"\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"firmware",children:"Firmware"}),"\n",(0,o.jsx)(n.p,{children:"The application + secure boot firmware files to be downloaded by the device."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"app"}),": Application firmware file (",(0,o.jsx)(n.code,{children:"device.app"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"boot"}),": Associated matching secure boot firmware file (",(0,o.jsx)(n.code,{children:"device.boot"}),")"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"The firmware for remote updates is different from the one used via the USB adapter!"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"fw"})]}),"\n",(0,o.jsx)(n.h4,{id:"update-secure-boot-and-app-firmware",children:"Update secure boot and app firmware"}),"\n",(0,o.jsx)(n.p,{children:"Example Data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": {\n    "app": "app-firmware-1.x.x-mcuboot-slot1.hex",\n    "boot": "app-boot-nrf9160-sec-TZ2-1.8.2-mcuboot-slot1.hex"\n  },\n  "q": "fw"\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"update-only-app-firmware",children:"Update only app Firmware"}),"\n",(0,o.jsx)(n.p,{children:"Example Data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": {\n    "app": "app-firmware-1.x.x-mcuboot-slot1.hex"\n  },\n  "q": "fw"\n}\n'})}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"Updating only the app firmware is the faster (since less data has to be downloaded by the device)."}),(0,o.jsxs)(n.p,{children:["The appropriate boot firmware version for a particular application firmware can be obtained from Lobaro.\nThe currently installed boot firmware can be read from the device properties (",(0,o.jsx)(n.code,{children:"device.boot"}),") in the Lobaro platform."]}),(0,o.jsx)(n.p,{children:"If in doubt use the command above that updates both firmware images."})]}),"\n",(0,o.jsx)(n.h4,{id:"update-only-secure-boot-firmware",children:"Update only secure boot Firmware"}),"\n",(0,o.jsx)(n.p,{children:"Example Data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": {\n    "boot": "app-boot-nrf9160-sec-TZ2-1.8.2-mcuboot-slot1.hex"\n  },\n  "q": "fw"\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"If in doubt use the command above that updates both firmware images."})}),"\n",(0,o.jsx)(n.h4,{id:"update-modem-firmware-detla",children:"Update modem firmware (detla)"}),"\n",(0,o.jsx)(n.p,{children:"Delta modem firmware updates can only be performed in patch version steps. Please consult Lobaro for available options."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"mfw"}),': Associated matching delta modem firmware file provided by Nordic Semiconductor ("device.modem")']}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Only newer Lobaro firmware support this type of update, e.g. app-nrf9160-wmbus+0.24.0 onwards."})}),"\n",(0,o.jsx)(n.p,{children:"Example Data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": {\n    "mfw": "mfw_nrf9160_update_from_1.3.2_to_1.3.4.bin"\n  },\n  "q": "fw"\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"lobaro-device-specific-downlinks",children:"Lobaro Device Specific Downlinks"}),"\n",(0,o.jsx)(n.h4,{id:"reboot-device",children:"Reboot Device"}),"\n",(0,o.jsx)(n.p,{children:"Device will reboot when receiving this command."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"fw"})]}),"\n",(0,o.jsx)(n.p,{children:"Example data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "q": "reboot"\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"comment--test",children:"Comment / Test"}),"\n",(0,o.jsx)(n.p,{children:"ASCII String that will be printed to device's Log when receiving this command."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"fw"})]}),"\n",(0,o.jsx)(n.p,{children:"Example data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "d": "ASCII string to print to log",\n  "q": "comment"\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"lorawan-downlinks",children:"LoRaWAN Downlinks"}),"\n",(0,o.jsx)(n.p,{children:"Send a lorawan downlink over the platform."}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsxs)(n.p,{children:["The integration with the LoRaWAN Network Server is required to send downlinks to the device. Integrations \u2192 LoRaWan, See also: ",(0,o.jsx)(n.a,{href:"/iot/platform/integrations/",children:"Integrations"})]}),(0,o.jsx)(n.p,{children:"At the moment only Chirpstack is supported for Downlinks."})]}),"\n",(0,o.jsxs)(n.p,{children:["To send a downlinks via LoRaWAN a json object with the fields ",(0,o.jsx)(n.code,{children:"type"}),", ",(0,o.jsx)(n.code,{children:"data"})," and ",(0,o.jsx)(n.code,{children:"fPort"})," must be queued."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"data"}),": The data to be sent to the device"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"type"}),": Specifies the encoding of the data field. Valid options are:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ascii"}),": The data field is a string that will be ascii encoded"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"hex"}),": The data field is a hex encoded string (e.g. ",(0,o.jsx)(n.code,{children:"0x01FF"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"base64"}),": The data field is a base64 encoded string (e.g. ",(0,o.jsx)(n.code,{children:"AQ=="}),")"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"fPort"}),": The LoRaWAN frame port to be used for the downlink. See device documentation for valid values."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"lorawan"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "data": "scmodeDurSec=15",\n  "type": "ascii",\n  "fPort": 128\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"chirpstack-specifics",children:"Chirpstack specifics"}),"\n",(0,o.jsx)(n.p,{children:"When you create a downlink it will be qued at the platform but only one downlink will be put into the downlink que of the chirpstack server at any time."}),"\n",(0,o.jsx)(n.p,{children:"It's not possible to always know if a downlink was send by the Chirpstack server.\nWhen a Device reconnects to the Chirpstack server with a new Join request Chirpstack drops the downlink queue for this device.\nThis and other cases will lead to situations where we can't say if a downlink was actually send by Chirpstack or not."}),"\n",(0,o.jsxs)(n.p,{children:["For more information observe the information in the downlink tab of your platform for the device or use the ",(0,o.jsx)(n.code,{children:"api/devices/{devId}/downlink"})," API Endpoint."]}),"\n",(0,o.jsx)(n.p,{children:"Always keep in mind that even a successfully send downlink can get lost due to the nature of LoRaWAN"}),"\n",(0,o.jsx)(n.h3,{id:"raw-format",children:"Raw Format"}),"\n",(0,o.jsxs)(n.p,{children:["Downlinks of type ",(0,o.jsx)(n.code,{children:"config"})," and ",(0,o.jsx)(n.code,{children:"fw"})," are always encoded in CBOR for Lobaro Devices.\nIt is also possible to send arbitrary data to other device."]}),"\n",(0,o.jsx)(n.p,{children:"Supported 3rd Party Devices:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Tektelek Devices support ",(0,o.jsx)(n.code,{children:"ASCII"})," downlinks"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"raw"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Fields:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"format"}),": Encoding of the data field. Valid options are:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ascii"}),": The data field is a string that will be ascii encoded"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"cbor"}),": The data field is a json object that will be cbor encoded"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"data"}),": The data to be sent to the device"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This can also be used to mimic the ",(0,o.jsx)(n.code,{children:"config"})," and ",(0,o.jsx)(n.code,{children:"fw"})," downlink types."]}),"\n",(0,o.jsx)(n.p,{children:"Mimic Config Change:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "format": "cbor",\n  "data": {\n    "d": {\n      "cmodeDurSec": 123\n    },\n    "q": "config"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Mimic Reboot:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "format": "cbor",\n  "data": {\n    "q": "reboot"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"tekelek-devices",children:"Tekelek Devices"}),"\n",(0,o.jsx)(n.p,{children:"Scheduling TCP/IP downlinks for Tekelek devices."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Type:"})," ",(0,o.jsx)(n.code,{children:"raw"})]}),"\n",(0,o.jsx)(n.p,{children:"Example Data:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "format": "ASCII",\n  "data": "ascii-downlink-payload"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},3855:(e,n,i)=>{i.d(n,{A:()=>o});const o=i.p+"assets/images/nav-downlinks-1aeaa3acca0eed3775caff1559db4237.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var o=i(6540);const s={},d=o.createContext(s);function r(e){const n=o.useContext(d);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(d.Provider,{value:n},e.children)}}}]);